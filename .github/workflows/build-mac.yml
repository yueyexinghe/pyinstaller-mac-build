name: Build for MacOS

on:  # 触发条件：当推送到 main 分支时自动构建
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: macos-latest  # 使用 GitHub 的 MacOS 虚拟机
    steps:
      - name: Checkout code  # 拉取代码
        uses: actions/checkout@v2

      - name: Set up Python  # 安装 Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'  # 自动选择最新 3.x 版本

      - name: Install dependencies  # 安装项目依赖
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller  # 安装 PyInstaller

      - name: Build with PyInstaller  # 打包为 MacOS 应用
        run: |
          pyinstaller --onefile --windowed --clean main.py
          mv dist/main dist/mac_app  # 重命名输出文件（可选）

      - name: Upload Artifact  # 上传构建产物供下载
        uses: actions/upload-artifact@v2
        with:
          name: mac-executable
          path: dist/mac_app
